---
# output: github_document
output: 
  pdf_document:
    keep_tex: true
    fig_caption: true
    latex_engine: pdflatex
    template: svm-latex-ms.tex
    number_sections: true
title: | 
        | Análisis Geostadístico de la Variabilidad en la precipitación pluvial en República Dominicana.
        
author:
- name:  Aleira Del Jesús, Grace Soriano, Wilnellia Fabián
  affiliation: Estudiantes, Universidad Autónoma de Santo Domingo (UASD)
abstract: "Resumen. Los cambios que se producen en el clima anualmente o de un periodo a otro, se lo podemos atribuir tanto a la variabilidad natural del clima como al cambio que es ocasionado por las actividades antropogénicas. Para poder obtener la significancia de los cambios observados en las provincias de la República Dominica, se analizó la variabilidad pluviométrica de la precipitación, correspondiente al año 1994." 
keywords: "Variabilidad Pluviométrica, Precipitación,Clima"
date: "`r format(Sys.time(), '%Enero %17, %2020')`"
geometry: margin=1in
fontfamily: mathpazo
fontsize: 11pt
# spacing: double
bibliography: bibliography.bib
# csl: plos-one.csl
csl: apa.csl
header-includes:
  \usepackage{pdflscape}
  \newcommand{\blandscape}{\begin{landscape}}
  \newcommand{\elandscape}{\end{landscape}}
editor_options: 
  chunk_output_type: console
---

```{r, include=F}
library(sf)
library(tidyverse)
library(spdep)
library(lmtest)
library(tmap)
library(RColorBrewer)
library(ggplot2)
library(gstat)
library(stars)

rutaprep <- 'data/onamet_prec_anual_sf.gpkg'
rutadiv <- 'data/divisionRD.gpkg'
st_layers(rutaprep)
prep <- st_read(rutaprep)
prep

st_layers(rutadiv)
prov <- st_read(rutadiv, layer = 'PROVCenso2010')
prov
prov <- st_read(dsn = 'data/divisionRD.gpkg', layer = 'PROVCenso2010')
plot(prov['PROV'])

st_crs(prep)
crsdestino <- 32619
preputm <- prep %>% st_transform(crs = crsdestino)
preputm

```
# Introducción
Una de las partes más importante del ciclo hidrológico es la precipitación. Esta lleva el agua dulce a la parte emergida de la corteza terrestre y, por ende, favorece la vida en nuestro planeta. La precipitación se genera en las nubes, cuando alcanzan un punto de saturación; en este punto las gotas de agua aumentan de tamaño hasta alcanzar una masa en que se precipitan por la fuerza de gravedad.

# Metodología
-Utilizamos la aplicación Rstudio para el desarrollo de nuestro proyecto. 

-Clonamos desde el Github la carpeta de "mi proyecto", la cual contiene los datos correspondientes para realizar los análisis espaciales.

-Los datos fueron suministrados por el profesor, el cual los obtuvo a través de la Oficina Nacional de Meteorrologia (ONAMET), que es el ente encargado de regulador la investigación y producción de la información meteorológica en el país.

Trabajamos con los datos de las precipitaciones del año 1994, de la siguiente tabla:

```{r}
prep %>% st_drop_geometry()
```

# Resultados
Los datos de preciciptacion analizados presentaron distribucion normal, es decir, que la muestra tiene un incremento gradual de la semivarianza hasta que se alcanza la meseta en el rango, por lo que, la semivarianza inicia en cero o cercana a éste para el intervalo de distancia cero.

```{r}
nrow(preputm)
summary(preputm$a1994)
hist(preputm$a1994)
hist(log(preputm$a1994))
shapiro.test(preputm$a1994)
shapiro.test(log(prep$a1994))
```
# Discusión o Conclusiones
El comportamiento de nuestros datos arrojan que el p-valor > 0.05, por lo que, podemos afirmar con un 95% de confianza que nuestros datos se ajustan a una distribución normal. Además, el grafico nos muestra que la semivarianza aumenta gradualmente hasta alcanzar el rango.

El objetivo principal del Análisis Geoestadístico, es aplicar las técnicas Kriging, realizando para ello la serie de cálculos previos, como el cálculo de los Variogramas Muestrales y de los Variogramas Modelos. Luego, aplicamos la interpolación por Kriging oridinario para obtener un resultado respecto a los datos analizados. Por ende, podemos concluir que los datos visualizados a través de los variogramas muestrales generados indican que tienen un Comportamiento Cuadrático, ya que estos representan variables continuas e infinitamente diferenciales, por lo que no puede cambiar rápidamente.

# Información de soporte
La Geoestadística es una ciencia cada vez más usada en distintos ámbitos científicos. Nació en la década de los 50 como una ciencia minera, con el fin de evaluar las reservas minerales útiles. Por lo tanto, es una ciencia joven, en pleno desarrollo. El término fue concebido por Georges Matheron.

La Geoestadística se basa en el hecho de que los datos van a estar correlacionados espacialmente, es decir, que un dato va a estar relacionado con datos cercanos, y esta dependencia va perdiendo fuerza a medida que nos alejamos del dato. Por ende, es una ciencia aplicada que estudia las variables distribuidas espacialmente, partiendo de una muestra representativa del fenómeno en estudio.

Como toda ciencia estadística, el objetivo de la Geoestadística, es la predicción. Para esto, se suelen aplicar las técnicas Kriging, que básicamente proporcionan una predicción, es decir, del valor en una posición espacial, a partir de una muestra dada. Para conseguir dicha estimación, primero ha de caracterizarse la relación de dependencia entre las distintas localizaciones espaciales; en este sentido, puede recurrirse a la estimación del covariograma o del variograma. 

@article{garcía2009variabilidad,

# *Script* reproducible
```{r, echo=T}

library(sf)
library(tidyverse)
library(spdep)
library(lmtest)
library(tmap)
library(RColorBrewer)
library(ggplot2)
library(gstat)
library(stars)

rutaprep <- 'data/onamet_prec_anual_sf.gpkg'
rutadiv <- 'data/divisionRD.gpkg'
st_layers(rutaprep)
prep <- st_read(rutaprep)
prep

st_layers(rutadiv)
prov <- st_read(rutadiv, layer = 'PROVCenso2010')
prov
prov <- st_read(dsn = 'data/divisionRD.gpkg', layer = 'PROVCenso2010')
plot(prov['PROV'])

st_crs(prep)
crsdestino <- 32619
preputm <- prep %>% st_transform(crs = crsdestino)
preputm

nrow(preputm)
summary(preputm$a1994)
hist(preputm$a1994)
hist(log(preputm$a1994))
shapiro.test(preputm$a1994)
shapiro.test(log(prep$a1994))

prep1994 <- na.omit(preputm[,c('Estación', 'a1994')])
prep1994$a1994log <- log(prep1994$a1994)
prep1994

ggplot() +
  geom_sf(data = prov, fill = 'white') +
  geom_sf(data = prep1994, aes(col = a1994log), size = 6) +
  scale_colour_gradient(low="#deebf7", high="#3182bd") +
  geom_sf_text(data = prov, aes(label=TOPONIMIA), check_overlap = T, size = 2) +
  geom_sf_text(data = prep1994, aes(label=Estación), check_overlap = T, size = 1.5) +
  theme_bw()

v1994 <- variogram(a1994log~1, prep1994)
v1994
plot(v1994, plot.numbers = T)

v1994_m <- fit.variogram(v1994, vgm(model = "Sph", range = 50000))
v1994_m
plot(v1994, v1994_m, plot.numbers = T)

v1994_m2 <- fit.variogram(v1994, vgm(model = "Exp", range = 50000))
v1994_m2
plot(v1994, v1994_m2, plot.numbers = T)

v1994_m3 <- fit.variogram(v1994, vgm(model = "Gau", range = 50000))
v1994_m3
plot(v1994, v1994_m3, plot.numbers = T)

attr(v1994_m, 'SSErr') 
attr(v1994_m2, 'SSErr')
attr(v1994_m3, 'SSErr')#Elegimos este

grd <- st_bbox(prov) %>%
  st_as_stars(dx = 3000) %>% # 3000 metros=3km de resolución espacial
  st_set_crs(crsdestino) %>%
  st_crop(prov)
grd
plot(grd)

k <- krige(formula = a1994log~1, locations = prep1994, newdata = grd, model = v1994_m3)
k
plot(k)

ggplot() +
  geom_stars(data = k, aes(fill = var1.pred, x = x, y = y)) + 
  scale_fill_gradient(low="#deebf7", high="#3182bd") +
  geom_sf(data = st_cast(prov, "MULTILINESTRING")) +
  geom_sf(data = prep1994) +
  geom_sf_text(data = prov, aes(label=TOPONIMIA), check_overlap = T, size = 2) +
  theme_bw()

ggplot() +
  geom_stars(data = exp(k), aes(fill = var1.pred, x = x, y = y)) + 
  scale_fill_gradient(low="#deebf7", high="#3182bd", trans = 'log10') +
  geom_sf(data = st_cast(prov, "MULTILINESTRING")) +
  geom_sf(data = prep1994) +
  geom_sf_text(data = prov, aes(label=TOPONIMIA), check_overlap = T, size = 2) +
  theme_bw()
```
# Referencias
